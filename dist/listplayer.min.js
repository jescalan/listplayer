!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t(require,exports,module):e.ListPlayer=t()}(this,function(e,t,n){"use strict";function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(){o(this,e)}return s(e,[{key:"on",value:function(e,t,n){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:n}),this}},{key:"once",value:function(e,t,n){function i(){r.off(e,i),t.apply(n,arguments)}var r=this;return i._=t,this.on(e,i,n)}},{key:"emit",value:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),i=0,r=n.length;for(i;r>i;i++)n[i].fn.apply(n[i].ctx,t);return this}},{key:"off",value:function(e,t){var n=this.e||(this.e={}),i=n[e],r=[];if(i&&t)for(var o=0,s=i.length;s>o;o++)i[o].fn!==t&&i[o].fn._!==t&&r.push(i[o]);return r.length?n[e]=r:delete n[e],this}}]),e}(),u=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.tracks=(e.tracks||[]).map(function(e){return"string"==typeof e?{src:e}:e}),n.loopTracks=e.loopTracks||!0,n.progressThroughTracks=e.progressThroughTracks||!0,n.el=n._injectAudioElement(),n.index=0,n._loadTrack(),n.progressThroughTracks&&n.el.addEventListener("ended",function(){n.next(),n.play()}),n.advanced&&n._loadAudioContext(),n}return r(t,e),s(t,[{key:"play",value:function(){return this.emit("play"),this._loadTrack(),this.el.play()}},{key:"pause",value:function(){return this.emit("pause"),this.el.pause()}},{key:"next",value:function(){this.emit("next"),this.index++,this.index>=this.tracks.length&&(this.loopTracks?this.index=0:(this.index--,this.emit("error","you are on the last track")));var e=this.playing();this._loadTrack(),e&&this.play()}},{key:"prev",value:function(){this.emit("prev"),this.index--,this.index<=0&&(this.loopTracks?this.index=this.tracks.length:(this.index++,this.emit("error","you are on the first track")));var e=this.playing();this._loadTrack(),e&&this.play()}},{key:"playing",value:function(){return!this.el.paused}},{key:"seek",value:function(e){return e?(this.emit("seek",e),void(this.el.currentTime=e)):this.el.currentTime}},{key:"_injectAudioElement",value:function(){var e=document.createElement("audio");return document.body.appendChild(e),e.style.display="none",e}},{key:"_loadTrack",value:function(){if(this._loadedTrack!==this.index){this.el.innerHTML="",this.currentTrack=this.tracks[this.index];var e=document.createElement("source");e.src=this.currentTrack.src,e.type="audio/mp3",this.el.appendChild(e),this.el.load(),this._loadedTrack=this.index}}},{key:"_loadAudioContext",value:function(){var e=window.AudioContext||window.webkitAudioContext;return e?(this.ctx=new e,void(this.src=this.ctx.createMediaElementSource(this.el))):this.emit("error","web audio api unsupported")}}]),t}(a);return u});